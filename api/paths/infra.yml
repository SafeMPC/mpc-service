paths:
  /api/v1/infra/wallets/{walletId}/members:
    post:
      operationId: postAddWalletMember
      summary: 添加钱包成员
      tags:
        - Infrastructure
      security:
        - Bearer: []
      parameters:
        - name: walletId
          in: path
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/AddWalletMemberPayload"
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/WalletMemberResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"
    delete:
      operationId: deleteWalletMember
      summary: 移除钱包成员
      tags:
        - Infrastructure
      security:
        - Bearer: []
      parameters:
        - name: walletId
          in: path
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/RemoveWalletMemberPayload"
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/WalletMemberResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/wallets/{walletId}/policy:
    put:
      operationId: putSigningPolicy
      summary: 设置签名策略
      tags:
        - Infrastructure
      security:
        - Bearer: []
      parameters:
        - name: walletId
          in: path
          required: true
          type: string
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/SetSigningPolicyPayload"
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/SigningPolicyResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"
    get:
      operationId: getSigningPolicy
      summary: 获取签名策略
      tags:
        - Infrastructure
      security:
        - Bearer: []
      parameters:
        - name: walletId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/SigningPolicyResponse"
        "404":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/passkeys:
    post:
      operationId: postAddPasskey
      summary: 添加用户Passkey
      tags:
        - Infrastructure
      security:
        - Bearer: []
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/postAddPasskeyPayload"
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/addPasskeyResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/nodes/register:
    post:
      tags:
        - Infrastructure
      summary: Register a new node
      operationId: postRegisterNode
      parameters:
        - name: payload
          in: body
          required: true
          schema:
            $ref: "#/definitions/nodeRegistration"
      responses:
        201:
          description: Node registered successfully
          schema:
            $ref: "#/definitions/nodeRegistrationResponse"
        default:
          $ref: "#/responses/errorResponse"

  /api/v1/infra/nodes/heartbeat:
    post:
      tags:
        - Infrastructure
      summary: Send heartbeat
      operationId: postHeartbeat
      parameters:
        - name: payload
          in: body
          required: true
          schema:
            $ref: "#/definitions/heartbeatRequest"
      responses:
        200:
          description: Heartbeat received
          schema:
            $ref: "#/definitions/heartbeatResponse"
        default:
          $ref: "#/responses/errorResponse"

  /api/v1/infra/keys:
    post:
      operationId: postCreateMpcKey
      summary: 创建密钥分片
      description: 执行分布式密钥生成（DKG），创建密钥分片并分发到各个节点
      tags:
        - MPC Keys
      security:
        - Bearer: []
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/postCreateKeyPayload"
      responses:
        "201":
          description: 密钥创建成功
          schema:
            $ref: "#/definitions/createKeyResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "403":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"
    get:
      operationId: getMpcKeys
      summary: 列出密钥
      description: 列出所有密钥，支持过滤和分页
      tags:
        - MPC Keys
      security:
        - Bearer: []
      parameters:
        - name: chain_type
          in: query
          type: string
          description: 链类型过滤
        - name: status
          in: query
          type: string
          description: 状态过滤
        - name: limit
          in: query
          type: integer
          default: 50
          maximum: 1000
        - name: offset
          in: query
          type: integer
          default: 0
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/listKeysResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/keys/derive:
    post:
      security:
      - Bearer: []
      description: 从根密钥派生子钱包密钥 (BIP-32)
      tags:
      - MPC Keys
      summary: 派生子密钥
      operationId: postDeriveMpcKey
      parameters:
      - name: body
        in: body
        required: true
        schema:
          $ref: '#/definitions/postDeriveKeyPayload'
      responses:
        "201":
          description: 密钥派生成功
          schema:
            $ref: '#/definitions/deriveKeyResponse'
        "400":
          $ref: '#/responses/errorResponse'
        "401":
          $ref: '#/responses/errorResponse'
        "500":
          $ref: '#/responses/errorResponse'

  /api/v1/infra/keys/{keyId}:
    get:
      operationId: getMpcKey
      summary: 获取密钥信息
      description: 获取指定密钥的详细信息
      tags:
        - MPC Keys
      security:
        - Bearer: []
      parameters:
        - name: keyId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/getKeyResponse"
        "404":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"
    delete:
      operationId: deleteMpcKey
      summary: 删除密钥
      description: 删除密钥及其所有分片
      tags:
        - MPC Keys
      security:
        - Bearer: []
      parameters:
        - name: keyId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: 删除成功
        "404":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "403":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/keys/{keyId}/address:
    post:
      operationId: postGenerateMpcKeyAddress
      summary: 生成地址
      description: 根据密钥生成区块链地址
      tags:
        - MPC Keys
      security:
        - Bearer: []
      parameters:
        - name: keyId
          in: path
          required: true
          type: string
        - name: chain_type
          in: query
          type: string
          required: true
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/generateAddressResponse"
        "404":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/sign:
    post:
      operationId: postMpcSign
      summary: 阈值签名
      description: 执行阈值签名，需要达到阈值的节点参与
      tags:
        - MPC Signing
      security:
        - Bearer: []
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/postSignPayload"
      responses:
        "200":
          description: 签名成功
          schema:
            $ref: "#/definitions/signResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "403":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/sign/batch:
    post:
      operationId: postMpcBatchSign
      summary: 批量阈值签名
      description: 并发执行多个阈值签名请求
      tags:
        - MPC Signing
      security:
        - Bearer: []
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/postBatchSignPayload"
      responses:
        "200":
          description: 批量签名成功
          schema:
            $ref: "#/definitions/batchSignResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "403":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/verify:
    post:
      operationId: postMpcVerify
      summary: 验证签名
      description: 验证签名的有效性
      tags:
        - MPC Signing
      security:
        - Bearer: []
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/postVerifyPayload"
      responses:
        "200":
          description: 验证成功
          schema:
            $ref: "#/definitions/verifyResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/nodes:
    post:
      operationId: postRegisterMpcNode
      summary: 注册节点
      description: 注册Coordinator或Participant节点
      tags:
        - MPC Nodes
      security:
        - Bearer: []
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/postRegisterNodePayload"
      responses:
        "201":
          description: 节点注册成功
          schema:
            $ref: "#/definitions/registerNodeResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"
    get:
      operationId: getMpcNodes
      summary: 列出节点
      description: 列出所有节点，支持过滤和分页
      tags:
        - MPC Nodes
      security:
        - Bearer: []
      parameters:
        - name: node_type
          in: query
          type: string
          description: 节点类型过滤
        - name: status
          in: query
          type: string
          description: 状态过滤
        - name: limit
          in: query
          type: integer
          default: 50
        - name: offset
          in: query
          type: integer
          default: 0
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/listNodesResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/nodes/{nodeId}:
    get:
      operationId: getMpcNode
      summary: 获取节点信息
      description: 获取指定节点的详细信息
      tags:
        - MPC Nodes
      security:
        - Bearer: []
      parameters:
        - name: nodeId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/getNodeResponse"
        "404":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/nodes/{nodeId}/health:
    get:
      operationId: getMpcNodeHealth
      summary: 节点健康检查
      description: 检查节点的健康状态
      tags:
        - MPC Nodes
      security:
        - Bearer: []
      parameters:
        - name: nodeId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: 成功
        "404":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/sessions:
    post:
      operationId: postCreateMpcSession
      summary: 创建签名会话
      description: 创建新的签名会话
      tags:
        - MPC Sessions
      security:
        - Bearer: []
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: "#/definitions/postCreateSessionPayload"
      responses:
        "201":
          description: 会话创建成功
          schema:
            $ref: "#/definitions/createSessionResponse"
        "400":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/sessions/{sessionId}:
    get:
      operationId: getMpcSession
      summary: 获取会话状态
      description: 获取签名会话的当前状态
      tags:
        - MPC Sessions
      security:
        - Bearer: []
      parameters:
        - name: sessionId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: 成功
          schema:
            $ref: "#/definitions/getSessionResponse"
        "404":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/sessions/{sessionId}/join:
    post:
      operationId: postJoinMpcSession
      summary: 加入签名会话
      description: 节点加入签名会话
      tags:
        - MPC Sessions
      security:
        - Bearer: []
      parameters:
        - name: sessionId
          in: path
          required: true
          type: string
        - name: node_id
          in: query
          type: string
          required: true
      responses:
        "200":
          description: 加入成功
        "400":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/sessions/{sessionId}/cancel:
    post:
      operationId: postCancelMpcSession
      summary: 取消签名会话
      description: 取消正在进行的签名会话
      tags:
        - MPC Sessions
      security:
        - Bearer: []
      parameters:
        - name: sessionId
          in: path
          required: true
          type: string
      responses:
        "200":
          description: 取消成功
        "404":
          $ref: "#/responses/errorResponse"
        "401":
          $ref: "#/responses/errorResponse"
        "500":
          $ref: "#/responses/errorResponse"

  /api/v1/infra/backup/shares/recover:
    post:
      tags: [Backup]
      summary: Recover MPC Share
      operationId: postRecoverMPCShare
      parameters:
        - name: body
          in: body
          schema:
            $ref: "#/definitions/recoverMPCShareRequest"
      responses:
        200:
          schema:
            $ref: "#/definitions/recoverMPCShareResponse"
        default:
          $ref: "#/responses/errorResponse"

  /api/v1/infra/backup/status:
    get:
      tags: [Backup]
      summary: Get Backup Status
      operationId: getBackupStatus
      parameters:
        - name: key_id
          in: query
          type: string
          required: true
      responses:
        200:
          schema:
            $ref: "#/definitions/getBackupStatusResponse"
        default:
          $ref: "#/responses/errorResponse"

  /api/v1/infra/backup/shares:
    get:
      tags: [Backup]
      summary: List Backup Shares
      operationId: listBackupShares
      parameters:
        - name: key_id
          in: query
          type: string
          required: true
        - name: node_id
          in: query
          type: string
      responses:
        200:
          schema:
            $ref: "#/definitions/listBackupSharesResponse"
        default:
          $ref: "#/responses/errorResponse"
